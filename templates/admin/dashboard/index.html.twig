{% extends 'base.html.twig' %}

{% block title %}Dashboard{% endblock %}

{% block body %}
<div class="container-fluid">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h1 class="h3 mb-1">Dashboard</h1>
                            <p class="text-muted mb-0">Welcome back, {{ app.user.firstName }} {{ app.user.middleName ? app.user.middleName ~ ' ' : '' }}{{ app.user.lastName }}!</p>
                        </div>
                        <div>
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exportReportModal">
                                <i class="fas fa-file-export me-2"></i>Export Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-0">Total Entries</h6>
                            <h2 class="mt-2 mb-0">1,234</h2>
                        </div>
                        <div class="fs-1">
                            <i class="fas fa-file-alt"></i>
                        </div>
                    </div>
                    <div class="mt-3">
                        <span class="badge bg-white text-primary">+12% from last month</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-0">Active Users</h6>
                            <h2 class="mt-2 mb-0">456</h2>
                        </div>
                        <div class="fs-1">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                    <div class="mt-3">
                        <span class="badge bg-white text-success">+5% from last month</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-0">Pending Approvals</h6>
                            <h2 class="mt-2 mb-0">89</h2>
                        </div>
                        <div class="fs-1">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                    <div class="mt-3">
                        <span class="badge bg-white text-warning">-3% from last month</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-0">System Health</h6>
                            <h2 class="mt-2 mb-0">98%</h2>
                        </div>
                        <div class="fs-1">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                    </div>
                    <div class="mt-3">
                        <span class="badge bg-white text-info">All systems operational</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Entry Statistics</h5>
                    <div id="entryChart"></div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Entry Distribution</h5>
                    <div id="entryDistributionChart"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity and Quick Actions -->
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h5 class="card-title mb-0">Recent Activity</h5>
                        <a href="{{ path('admin_activity') }}" class="btn btn-sm btn-outline-primary">View All</a>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>User</th>
                                    <th>Activity</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>2 mins ago</td>
                                    <td>John Doe</td>
                                    <td>Approved entry #12345</td>
                                    <td><span class="badge bg-success">Success</span></td>
                                </tr>
                                <tr>
                                    <td>15 mins ago</td>
                                    <td>Jane Smith</td>
                                    <td>Created new announcement</td>
                                    <td><span class="badge bg-success">Success</span></td>
                                </tr>
                                <tr>
                                    <td>1 hour ago</td>
                                    <td>Mike Johnson</td>
                                    <td>Updated system settings</td>
                                    <td><span class="badge bg-success">Success</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title mb-4">Quick Actions</h5>
                    <div class="d-grid gap-2">
                        <a href="{{ path('admin_entries_new') }}" class="btn btn-primary">
                            <i class="fas fa-plus me-2"></i>New Entry
                        </a>
                        <a href="{{ path('admin_users_new') }}" class="btn btn-outline-primary">
                            <i class="fas fa-user-plus me-2"></i>Add User
                        </a>
                        <a href="{{ path('admin_announcements_new') }}" class="btn btn-outline-primary">
                            <i class="fas fa-bullhorn me-2"></i>New Announcement
                        </a>
                        <a href="{{ path('admin_reports') }}" class="btn btn-outline-primary">
                            <i class="fas fa-chart-bar me-2"></i>Generate Report
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Export Report Modal -->
<div class="modal fade" id="exportReportModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Export Dashboard Report</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label class="form-label">Report Format</label>
                        <select class="form-select">
                            <option value="excel">Excel (.xlsx)</option>
                            <option value="pdf">PDF (.pdf)</option>
                            <option value="csv">CSV (.csv)</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Date Range</label>
                        <div class="input-group">
                            <input type="date" class="form-control" value="{{ 'now'|date('Y-m-d') }}">
                            <span class="input-group-text">to</span>
                            <input type="date" class="form-control" value="{{ 'now'|date('Y-m-d') }}">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Include Sections</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="includeStats" checked>
                            <label class="form-check-label" for="includeStats">Statistics</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="includeCharts" checked>
                            <label class="form-check-label" for="includeCharts">Charts</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="includeActivity" checked>
                            <label class="form-check-label" for="includeActivity">Recent Activity</label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary">Export</button>
            </div>
        </div>
    </div>
</div>

{% block javascripts %}
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Entry Statistics Chart
    const entryOptions = {
        series: [{
            name: 'Total Entries',
            data: [150, 230, 180, 290, 200, 250]
        }],
        chart: {
            type: 'line',
            height: 300,
            toolbar: {
                show: false
            }
        },
        colors: ['#4BC0C0'],
        stroke: {
            curve: 'smooth',
            width: 3
        },
        xaxis: {
            categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun']
        },
        yaxis: {
            title: {
                text: 'Number of Entries'
            }
        },
        tooltip: {
            theme: 'light'
        },
        grid: {
            borderColor: '#f1f1f1'
        }
    };

    const entryChart = new ApexCharts(document.querySelector("#entryChart"), entryOptions);
    entryChart.render();

    // Entry Distribution Chart
    const distributionOptions = {
        series: [40, 35, 25],
        chart: {
            type: 'donut',
            height: 300
        },
        labels: ['BAI', 'BFAR', 'BPI'],
        colors: ['#FF6384', '#36A2EB', '#FFCE56'],
        legend: {
            position: 'bottom'
        },
        plotOptions: {
            pie: {
                donut: {
                    size: '70%'
                }
            }
        },
        responsive: [{
            breakpoint: 480,
            options: {
                chart: {
                    width: 200
                },
                legend: {
                    position: 'bottom'
                }
            }
        }]
    };

    const distributionChart = new ApexCharts(document.querySelector("#entryDistributionChart"), distributionOptions);
    distributionChart.render();

    // Handle date range validation
    const dateInputs = document.querySelectorAll('input[type="date"]');
    dateInputs.forEach(input => {
        input.addEventListener('change', function() {
            const startDate = new Date(dateInputs[0].value);
            const endDate = new Date(dateInputs[1].value);
            
            if (endDate < startDate) {
                alert('End date cannot be earlier than start date');
                this.value = dateInputs[0].value;
            }
        });
    });
});
</script>
{% endblock %}
{% endblock %} 